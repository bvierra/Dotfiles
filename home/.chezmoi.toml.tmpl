encryption = "age"
[age]
  identity = "{{ .chezmoi.homeDir -}}/.config/chezmoi/key.txt"
  recipient = "age17lav4s6j0lchx0t05mr85l3htuqk7eeuth5ksvwzv0c8dw63zc4stw50nf"

{{- $personal := env "bvierra" -}}

{{/* boolean feature tags */}}
{{- $ephemeral := false -}}{{/* true if this machine is ephemeral */}}
{{- $secrets := false -}}{{/* true if this machine store secrets with gpg and pass */}}

{{/* vars */}}
{{- $name := "" -}}
{{- $email := "" -}}
{{- $key_sign := "" -}}
{{- $username := .chezmoi.username -}}
{{- $hostname := .chezmoi.hostname -}}
{{- "" -}}

{{/* set editor, diff, and merge to code by default */}}
{{/* you will be prompted for these values if they are not set */}}
{{/* if you set any of these to code, then it will automatically setup the command with the correct args */}}
{{- $editor := "" -}}
{{- $diff := "" -}}
{{- $merge := "" -}}


{{/* set OS to osID */}}
{{- $osID := .chezmoi.os -}}
{{- if (and (eq .chezmoi.os "linux") (hasKey .chezmoi.osRelease "id")) -}}
{{-   $osID = printf "%s-%s" .chezmoi.os .chezmoi.osRelease.id -}}
{{- end -}}

{{- $archDL := .chezmoi.arch -}}
{{- if eq .chezmoi.arch "amd64" -}}
{{-   $archDL = "x86_64" -}}
{{- end -}}

{{- $isWSL := false -}}

{{/* set isWSL to true if in WSL, otherwise false */}}
{{- $isWSL := false -}}
{{- if eq .chezmoi.os "linux" -}}
{{-   if (.chezmoi.kernel.osrelease | lower | contains "microsoft") -}}
{{-     $isWSL = true -}}
{{-   end -}}
{{- end -}}

{{- /* Set standard values for required config options if personal */ -}}
{{- if $personal -}}
{{-   $name = "Billy Vierra" -}}
{{-   $email = "bvierra@gmail.com" -}}
{{-   $key_sign = "C76E7D8E3369C6A4" -}}
{{-   $editor = "code" -}}
{{-   $diff = "delta" -}}
{{-   $merge = "code" -}}
{{- else -}}
{{- /* If name was previously set, reuses it */ -}}
{{-   if hasKey . "name" -}}
{{-     $name = .name -}}
{{- /* Otherwise, if running interactively, prompts for a name */ -}}
{{-   else if stdinIsATTY -}}
{{-     $name = promptString "name" "Your Name" -}}
{{-   end -}}

{{- /* Does the same for the email */ -}}
{{-   if hasKey . "email" -}}
{{-     $email = .email -}}
{{-   else if stdinIsATTY -}}
{{-     $email = promptString "email" "your@email.com" -}}
{{-   end -}}

{{- /* Does the same for the email */ -}}
{{-   if hasKey . "editor" -}}
{{-     $editor = .editor -}}
{{-   else if stdinIsATTY -}}
{{-     $editor = promptString "editor" "vim" -}}
{{-   end -}}
{{- end -}}

{{- $lat := "0" -}}
{{- $lon := "0" -}}
{{- if env "bvierra_lat" -}}
{{-   $lat = env "bvierra_lat" -}}
{{- end -}}
{{- if env "bvierra_lon" -}}
{{-   $lon = env "bvierra_lon" -}}
{{- end -}}

{{- if (stdinIsATTY) -}}
{{-   if (and (eq $lat "0") (eq $lon "0")) -}}
{{-     writeToStdout "üåç You can set your location (latitude and longitude) to show the weather in your tmux status line.\n" -}}
{{-     writeToStdout "üåç You can find your latitude and longitude at https://www.latlong.net/.\n" -}}
{{-     writeToStdout "üåç If you do not set a location, it will disable weather in your tmux status line.\n" -}}
{{-     if (eq $lat "0") -}}
{{-       $lat = promptString "latitude" "0" -}}
{{-     end -}}
{{-     if (eq $lon "0") -}}
{{-       $lon = promptString "longitude" "0" -}}
{{-     end -}}
{{-     writeToStdout (printf "üåç Your location is set to lat=%s lon=%s\n" $lat $lon) -}}
{{-   end -}}
{{- end -}}

sourceDir = {{ .chezmoi.sourceDir | quote }}

[data]
  archDL = {{ $archDL | quote }}
  name = {{ $name | quote }}
  personal = {{ $personal }}
  email = {{ $email | quote }}
  key_sign = {{ $key_sign | quote }}
  osid = {{ $osID | quote }}
  isWSL = {{ $isWSL }}
  editor = {{ $editor | quote }}
  diff = {{ $diff | quote }}
  merge = {{ $merge | quote }}
  lat = {{ $lat | quote }}
  lon = {{ $lon | quote }}

{{ if eq $editor "code" -}}
[edit]
  command = "code"
  args = ["--wait"]
{{ else if ne $editor "" -}}
[editor]
  command = {{ $editor | quote }}
{{ end }}


[diff]
  exclude = ["externals"]
{{ if eq $diff "code" -}}
  command = "code"
  args = ["--wait", "--diff", "--new-window"]
{{ else if eq $diff "delta" }}
  command = "delta"
  pager = "delta"
{{ else if ne $diff "" -}}
  command = {{ $diff | quote }}
{{ end }}

{{ if eq $merge "code" -}}
[merge]
  command = "bash"
  args = [
    "-c",
    "cp {{ "{{" }} .Target {{ "}}" }} {{ "{{" }} .Target {{ "}}" }}.base && code --new-window --wait --merge {{ "{{" }} .Destination {{ "}}" }} {{ "{{" }} .Target {{ "}}" }} {{ "{{" }} .Target {{ "}}" }}.base {{ "{{" }} .Source {{ "}}" }}"
  ]
{{ else if ne $merge "" -}}
[merge]
  command = {{ $merge | quote }}
{{ end }}

{{- if stdinIsATTY -}}
{{-   writeToStdout "üí° Tip: you can re-enter your name and email with `chezmoi init --data=false`.\n" -}}
{{- end -}}
